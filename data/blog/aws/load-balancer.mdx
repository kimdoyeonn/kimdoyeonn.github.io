---
title: '로드밸런서(Load Balancer)'
date: '2024-01-20'
tags: ['aws']
draft: false
---

# 로드밸런서(Load Balancer)

- 클라이언트에 대한 단일 접점 역할을 수행
- 클라이언트는 로드밸런서로 요청을 전송하고 로드 밸런서는 EC2 같은 대상으로 요청을 전송

---

- 로드밸런서를 구성하려는 경우, 대상 그룹을 생성하여 대상을 해당 대상 그룹에 등록한다.
    
    ![대상그룹설정](https://github.com/kimdoyeonn/library/assets/53068706/0f2346e0-05ff-491b-9d76-814e44bc5919)
    
- 리스너를 생성하여 클라이언트의 연결 요청을 확인하고 클라이언트에서 하나 이상의 대상 그룹에 있는 대상으로 요청을 라우팅하는 리스너 규칙을 만든다.
    
    ![리스너설정](https://github.com/kimdoyeonn/library/assets/53068706/a0863455-3a47-441a-bbeb-ef228e6369d4)
    

# 연결 유휴 제한 시간(Connection idle timeout)

클라이언트가 로드밸런서를 통해 생성하는 각 요청에 대해 로드밸런서는 두가지 연결을 유지한다.

- 프론트엔드 연결
    
    클라이언트와 로드밸런서 사이의 연결
    
- 백엔드 연결
    
    로드밸런서와 대상 사이의 연결
    

그리고 이 연결을 유지하는 유휴 제한 시간이 있다.

이 시간이 경과할 때까지 데이터가 전송되거나 수신되지 않으면 로드밸런서는 프론트엔드 연결을 종료한다. 때문에 파일 업로드 같이 시간이 오래 걸리는 작업이 완료될 수 있도록 하려면 유휴 제한 시간이 경과하기 전에 최소 1바이트의 데이터를 전송하고 필요에 따라 유휴 제한 시간의 길이를 늘인다.

백엔드 연결의 경우 EC2 인스턴스에 대해 HTTP 연결 유지 옵션을 활성화하는 것이 좋다. (HTTP 연결 유지는 EC2 인스턴스의 웹 서버 설정에서 활성화 가능) HTTP 연결 유지를 활성화하면 연결 유지 초과 시간이 만료될 때까지 로드 밸런서가 백엔드 연결을 다시 사용할 수 있다. 또한 애플리케이션의 유휴 제한 시간을 로드 밸런서에 구성된 유휴 제한 시간보다 크게 설정하는 것이 좋다. 그렇게 하지 않으면 애플리케이션이 로드 밸런서에 대한 TCP 연결을 비정상적으로 닫을 경우, 로드 밸런서가 연결이 닫혔음을 가리키는 패킷을 받기 전에 애플리케이션에 요청을 전송할 수 있다. 이 경우 로드 밸런서는 HTTP 502 bad gateway 오류를 클라이언트에 전송한다.