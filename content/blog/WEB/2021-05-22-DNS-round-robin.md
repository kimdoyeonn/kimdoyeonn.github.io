---
title: "[network]DNS Round Robin이란?"
excerpt: ""
category:
  - network
tags: [network]
---

## DNS

DNS란 Domain Name System의 약자로서 IP 네트워크에서 사용하는 시스템이다.

사용자가 사람이 읽을 수 있는 도메인 이름([ww.google.com](http://ww.google.com))으로 접속하면 머신이 읽을 수 있는 IP주소(192.0.2.44)로 변환해야 사용자에게 올바른 서비스를 제공할 수 있는데, 이때 도메인 주소와 주소체계를 상호 확인 및 변활 할 수 있도록 하는 시스템을 DNS라고 한다.

- 예를 들어 우리가 구글에 접속하려 한다고 가정해보자. 이 때 원칙적으로 우리는 구글의 IP 주소를 알고 있어야하고, 그 IP 주소를 통해서 접속해야 합니다. 하지만 우리는 구글에 접속할 떄 일반적으로 [google.com](http://google.com) 이라는 도메인 주소를 사용합니다. 이것은 우리가 모르는 사이 어떤 시스템에 의해 우리가 입력한 google.com가 구글의 IP 주소로 변환되어 구글에 접속할 수 있었다는 것을 의미합니다. 이 때 도메인 입력만으로 우너하는 웹서버에 접속할 수 있도록 도와주는 시스템을 DNS라고 합니다.

**DNS Server**

웹 서버 주소에 해당하는 IP 주소 테이블을 가지고 있는 서버라고 할 수 있습니다. google.com이 가리키고 있는 IP 주소를 브라우저에게 반환합니다.





### DNS 과정

1. DNS Query

   DNS 서버에서 Domain Name을 이용하여 IP를 받아옵니다. 이때 Domain Name Server에 접속하는 유저에 대해서 Round Robin 방식으로 IP를 할당합니다.

2. IP Communication

   IP를 받아온 유저는 리퀘스트 메세지 발송을 통하여 정상적으로 네트워크 통신을 실시합니다.





## DNS round robin

round robin이란 DNS 서버 구성 방식 중 하나입니다.

Domain에 대한 IP 요청 쿼리시 round-robin 방식으로 IP를 반환합니다.

![https://blog-imgs-136-origin.fc2.com/d/a/i/dailusia/Round_Robin_Schedule_Example.jpg](https://blog-imgs-136-origin.fc2.com/d/a/i/dailusia/Round_Robin_Schedule_Example.jpg)

시분할 시스템을 위해 설계된 선점형 스케줄링의 하나로서, 프로세스들 사이에 우선순위를 두지 않고, 순서대로 시간단위(Time Quantum/Slice)로 CPU를 할당하는 방식의 CPU 스케줄링 알고리즘입니다.

쉽게 말하면 자바에서 스레드가 운영체제의 스케줄러에 의하여 컴퓨터 자원을 사용할 수 있는 기회를 할당 받는 것과 같은 맥락입니다.

각 프로세스에 일정시간을 할당하고, 할당된 시간이 지나면 그 프로세스는 잠시 보류한 뒤 다른 프로세스에게 기회를 주고, 또 그 다음 프로세스에게 하는 식으로, 돌아가며 기회를 부여하는 운영방식이라 풀어 말할 수 있겠습니다.

즉, DNS 서버에 대한 Round Robin 형식으로 구성할 경우 로드 밸러서가 필요가 없습니다.

부하에 대한 걱정을 할 필요가 없다는 뜻입니다.



**단점**

1. **서버의 수 만큼 공인 IP 주소가 필요합니다.**

   부하 분산을 위한 서버의 대수를 늘리기 위해서는 그 만큼의 공인 IP가 필요합니다.

2. **균등하게 분산되지 않습니다.**

   모바일 사이트 등에서 문제가 될 수 있는데, 스마트폰의 접속은 캐리어 게이트웨이라고 하는 프록시 서버를 경유합니다.

   [프록시 서버](https://www.notion.so/Proxy-Server-e80f7fee9b60451eab1c4053619e4dd2)에서는 이름 변환 결과가 일정 시간 동안 캐싱되므로 같은 프록시 서버를 경유하는 접속은 항상 같은 서버로 접속됩니다.

   또한 PC 용 웹 브라우저도 DNS 질의 결과를 캐싱하기 때문에 균등하게 부하분산 되지 않습니다.

   DNS 레코드의 TTL값을 짧게 설정함으로써 어느 정도 해소가 되지만, TTL에 따라 캐시를 해제하는 것은 아니므로 반드시 주의가 필요합니다.

   [프록시 서버(Proxy Server)란?](https://www.notion.so/Proxy-Server-e80f7fee9b60451eab1c4053619e4dd2)

3. **서버가 다운돼도 확인이 불가능합니다.**

   DNS 서버는 웹 서버의 부하나 접속 수 등의 상황에 따라 질의 결과를 제어할 수 없습니다.

   웹 서버의 부하가 높아서 응답이 느려지거나 접속 수가 꽉 차서 접속을 처리 할 수 없는 상황인지를 전혀 감지 할 수가 없기 때문에 어떤 원인으로 다운되더라도 이를 검출하지 못하고 유저들에게 제공합니다.

   이때문에 간혹 유저들은 다운된 서버에 연결되기도 합니다.

   DNS round robin은 어디까지나 부하분산을 위한 방법이지 다중화 방법은 아니므로 다른 S/W와 조합하여 관리할 필요가 있습니다.

   

**극복방법**

### 다중 구성 방식 (Synchronous Time-Division Multiplexing)

AP 서버에 VIP(Vitual IP)를 부여해서 다중화를 구성한다. 각 AP서버를 Health Check 후 이상이 감지되면 VIP를 정상 AP 서버로 인계하는 방식을 사용한다.

즉 DNS Server Table에 실시간으로 AP 서버의 상태를 확인할 수 있는 칼럼 및 함수를 추가하여 요청될 경우 서버 상태를 확인하여 우회루트를 제공하거나 에러를 전송하는 방식을 말합니다.

### 가중치 편성 방식(Weighted round robin)

각각의 웹 서버에 가중치를 가미해서 분산 비율을 변경한다. 물론 가중치가 큰 서버일수록 빈번하게 선택되므로 처리능력이 높은 서버는 가중치를 높게 설정하는 것이 좋다.

### 최소 연결 방식(Least connection)

*로드 밸런서의 도입을 통한 구성*

접속 클라이언트 수가 가장 적은 서버를 선택한다. 로드밸런서에서 실시간으로 connection 수를 관리하거나 각 서버에서 주기적으로 알려주는 것이 필요하다.