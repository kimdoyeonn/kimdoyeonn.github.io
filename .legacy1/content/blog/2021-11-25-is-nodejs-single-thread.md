---
title: Node.js는 싱글 스레드다?
date: 2021-11-25 23:41:25
categories:
tags:
---
## 프로세스(process)란?

운영체제에서 실행 중인 하나의 프로그램을 프로세스라고 한다. 

프로그램이 실행되면 프로세스가 메모리에 적제되어 운영체제로부터 다른 프로세스와 독립된 메모리 영역(code, data, stack, heap)을 할당받는다. 

크롬 창을 여러 개 띄울 수 있듯이 하나의 프로그램은 여러 개의 프로세스를 가질 수 있다. 

## 스레드(thread)란?

사전적 의미로는 한 가닥의 실이라는 뜻으로, **프로세스 내에서 실행되는 흐름의 단위**이다. 하나의 프로세스는 여러 개의 스레드를 가질 수 있으며 각각의 스레드는 독립적으로 작동한다. 한 번에 돌릴 수 있는 스레드의 개수는 컴퓨터의 코어 개수와 같다. 한 번에 돌릴 수 있는 스레드가 하나인 경우를 싱글 스레드라고 하고, 2개 이상인 경우를 멀티 스레드라고 한다.

스레드는 프로세스가 운영체제로부터 할당받은 메모리 공간 위에서 동작한다. 각각의 스레드는 독립된 stack을 할당받고, code, data, heap 영역은 서로 공유한다.

## 멀티 스레드(multi-thread)란?

멀티스레드는 두 개 이상의 스레드를 가지는 경우를 말한다. 즉, 두 가지 이상의 작업을 동시에 처리할 수 있다. 

운영체제는 멀티 태스킹이 가능하도록 프로세스마다 컴퓨터 자원을 적절히 할당하고 병렬로 실행한다. 이를 멀티 프로세스라고 한다

또, 한 프로세스 내에서 멀티 태스킹을 할 수 있도록 만들어진 경우도 있다. 이 경우가 멀티 스레드이다.

**멀티 프로세스가 프로그램 단위의 멀티 태스킹이라면, 멀티 스레드는 프로그램 내부에서의 멀티 태스킹이라고 할 수 있다.**

## Node.js는?

[이벤트 루프](https://www.notion.so/3487bff0325348d0807cf12adaf11083)

Node.js는 V8 엔진을 사용한다. 그리고 V8엔진은 싱글 스레드 이벤트 루프를 사용한다고 알려져 있다. 아 그럼 Node.js는 싱글 스레드이구나 할 수 있는데, 맞을 수도 있고 아닐 수도 있다.

![image](https://user-images.githubusercontent.com/53068706/143461340-77f91bfe-e25b-4d30-b67e-fa5e64b2e498.png)


Node.js 애플리케이션는 세 가지 영역으로 나눌 수 있다.

1. 자바스크립트 코드
2. c++ 라이브러리인 libuv
3. 자바스크립트 코드와 libuv 라이브러리와 V8 사이의 인터페이스 역할을 하는 Node.js

### libuv

여기서 Node.js가 멀티스레드로도 동작하게 만드는 부분은 libuv에 구현되어 있다.

우선 libuv에 대해 정리해보면, 비동기 입출력에 초점을 둔 멀티 플랫폼 지원 라이브러리이다. 다양한 네트워크, 운영체제와 관련된 기능을 포함하고 있으며, 주로 Node.js에 사용하기 위해 개발되었다. 기존 브라우저에서만 구동되던 자바스크립트를 브라우저 밖에서 구동될 수 있도록 해주기 위해 개발된 라이브러리라고 볼 수 있다. V8이 컨버팅한 c++ 코드를 이해하고 실행하는 역할을 한다.

libuv는 OS 관련 처리를 위해 4개의 스레드 풀을 세팅한다. 그리고 이 스레드 풀 때문에 `crypto` 같은 node.js 내장 객체를 사용해보면 멀티 스레드로 동작하고 있는 것을 알 수 있다.

## 결론

자바스크립트 기반 언어인 Node.js는 기본적으로 싱글 스레드로 동작한다. 하지만 Node.js는 자바스크립트 만으로 이루어지지 않았다. 자바스크립트가 브라우저를 벗어나도록 만들어준 c++로 이루어진 libnv 라이브러리는 OS 작업을 위해 스레드 풀이라고 하는 기본 4개의 스레드를 추가로 세팅한다. 그리고 이 부분을 이용하는 입출력 작업 CPU 작업 모듈들은 사용할 경우 스레드 풀을 사용하게 되면서 멀티 스레드으로 동작하게 된다.

**즉, Node.js는 기본적으로 싱글 스레드로 동작하지만 항상 그런 것은 아니며, 일부 모듈을 사용할 경우 멀티 스레드로 동작할 수 있다.**

출처:

- **[왜 node.js는 single-thread 인가](https://medium.com/@gwakhyoeun/%EC%99%9C-node-js%EB%8A%94-single-thread-%EC%9D%B8%EA%B0%80-bb68434027a3)**
- **[Javascript와 Nodejs, 그리고 싱글 스레드](https://gyofeel.github.io/js/nodejs/web/Javascript%EC%99%80-Nodejs%EB%8A%94-%EB%AA%A8%EB%91%90-%EC%8B%B1%EA%B8%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%97%90%EC%84%9C-%EC%8B%A4%ED%96%89%EB%90%98%EB%8A%94%EA%B0%80/)**